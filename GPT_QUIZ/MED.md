```ruby
WITH FIRTERED AS (
    SELECT CUSTOMER_ID
           , SUM(AMOUNT) TOTAL_AMOUNT
    FROM CUSTOMERS C
    LEFT JOIN ORDERS O USING C.CUSTOMER_ID = O.CUSTOMER_ID
    WHERE YEAR(ORDER_DATE) = 2023
    GROUP BY CUSTOMER_ID
    ORDER BY TOTAL_AMOUNT DESC, CUSTOMER_ID
    LIMIT 3
    ;
)

SELECT CUSTOMER_NAME, TOTAL_AMOUNT
FROM FIRTERED
```


